# Mcp-Rag-Chat-Android

## 项目概述

这是一个基于检索增强生成（Retrieval-Augmented Generation，RAG）的智能问答Android应用。该应用利用多源检索增强技术，通过不同的搜索模式（普通模式、知识库模式和网络搜索模式）为用户提供准确、相关的回答。应用采用流式响应机制，实现实时、流畅的对话体验。

## RAG技术实现

本应用核心基于RAG技术实现智能问答功能：

### 多源检索增强

应用支持三种搜索模式（`SearchMode`枚举）：
- **NORMAL**：普通对话模式，直接与AI模型交互
- **KNOWLEDGE_BASE**：知识库模式，从预定义的知识库中检索相关信息增强回答
- **WEB**：网络搜索模式，从互联网获取最新信息增强回答

### RAG工作流程

1. **用户提问**：用户通过聊天界面发送问题
2. **模式选择**：系统根据当前选择的搜索模式确定检索策略
3. **信息检索**：根据不同模式从相应来源检索相关信息
4. **增强生成**：将检索到的信息与用户问题结合，生成更准确、更相关的回答
5. **流式响应**：通过SSE（Server-Sent Events）技术实现回答的实时流式显示

## 技术栈

### 架构模式
- **Clean Architecture**：分离关注点，提高代码可测试性和可维护性
- **MVVM**：实现UI与业务逻辑的分离
- **模块化设计**：提高代码复用性和可维护性

### 核心技术
- **Kotlin**：主要开发语言
- **Jetpack Compose**：现代化UI工具包
- **Coroutines & Flow**：处理异步操作和响应式数据流
- **Hilt**：依赖注入框架
- **Retrofit**：网络请求库
- **SSE（Server-Sent Events）**：实现服务器到客户端的实时数据推送

## 项目结构

### 模块划分

- **app**：应用入口，负责组装各个模块
- **domain**：包含业务实体和用例，定义核心业务逻辑
  - 业务实体：`Message`、`MessageType`、`SearchMode`等
  - 用例：`SendMessageUseCase`、`GetMessagesUseCase`、`ClearMessagesUseCase`等
- **data**：实现领域层定义的仓库接口，处理数据源
  - 实现：`ChatRepositoryImpl`
  - 网络：`SseClient`、`ChatApi`等
- **feature/chat**：聊天功能模块，包含UI和ViewModel
  - UI：`ChatScreen`等
  - ViewModel：`ChatViewModel`
- **core**：核心工具和UI组件

### 依赖关系

```
┌───────────────────────────────────────────────────────────────┐
│                         表示层                                 │
│                                                               │
│  ┌─────────┐           ┌─────────────┐                        │
│  │         │           │             │                        │
│  │   app   │──────────▶│ feature/chat│                        │
│  │         │           │             │                        │
│  └─────────┘           └──────┬──────┘                        │
│       │                       │                               │
└───────┼───────────────────────┼───────────────────────────────┘
        │                       │
        │                       │
        │                       ▼
┌───────▼───────┐      ┌────────────────┐      ┌─────────────┐
│               │      │                │      │             │
│     core      │◀─────│     domain     │◀─────│    data     │
│               │      │                │      │             │
└───────────────┘      └────────────────┘      └─────────────┘
                             ▲
                             │
                             │
                       ┌─────┴──────┐
                       │  业务逻辑层  │
                       └────────────┘
```

模块依赖说明：
- **app**：应用入口模块，依赖feature/chat和core模块
- **feature/chat**：聊天功能UI模块，依赖domain和core模块
- **domain**：核心业务逻辑模块，定义实体和用例，被data和feature/chat模块依赖
- **data**：数据层模块，依赖domain模块，实现其接口和数据源访问
- **core**：基础组件模块，提供通用工具和UI组件，被app和feature/chat模块依赖

架构分层：
- 表示层：包含app和feature/chat模块，负责UI展示和用户交互
- 业务逻辑层：包含domain模块，定义核心业务规则和用例
- 数据层：包含data模块，负责数据获取和存储
- 基础设施层：包含core模块，提供跨层通用功能

## 业务逻辑

### 聊天功能

- **消息发送**：用户输入消息后，通过`SendMessageUseCase`发送到服务器
- **消息接收**：通过SSE连接接收服务器实时返回的消息
- **多模式切换**：支持在不同搜索模式间切换，实现不同的检索增强策略

### 连接状态管理

应用实时显示SSE连接状态，包括：
- 连接中
- 已连接
- 断开连接
- 连接错误

## 网络通信

### API通信

- 使用Retrofit实现RESTful API调用
- 根据不同搜索模式调用不同的API端点

### 实时通信

- 使用SSE技术实现服务器到客户端的实时数据推送
- `SseClient`负责建立和维护SSE连接
- 通过Flow处理消息流，实现UI的实时更新

## 开发与部署

### 环境要求

- Android Studio Arctic Fox或更高版本
- JDK 11或更高版本
- Android SDK 31或更高版本

### 构建与运行

```bash
# 克隆仓库
git clone [仓库URL]

# 进入项目目录
cd Mcp-Rag-Chat-Android

# 构建项目
./gradlew build

# 安装到设备
./gradlew installDebug
```

## 特点与优势

- **多源检索增强**：结合多种信息源提供更准确的回答
- **实时流式响应**：提供流畅的对话体验
- **模块化架构**：便于扩展和维护
- **Clean Architecture**：提高代码质量和可测试性
- **现代化UI**：使用Jetpack Compose构建响应式界面

## 未来计划

- 增加更多检索源支持
- 优化检索算法
- 添加离线模式支持
- 增强用户体验和界面设计